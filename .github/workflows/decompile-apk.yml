name: Decompile APK (Resources Only)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  decompile:
    runs-on: ubuntu-latest

    steps:
    # 1️⃣ Checkout repo
    - name: Checkout code
      uses: actions/checkout@v4

    # 2️⃣ Setup Java (apktool needs it)
    - name: Set up JDK
      uses: actions/setup-java@v4
      with:
        distribution: temurin
        java-version: '17'

    # 3️⃣ Install system tools
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip

    # 4️⃣ Install apktool
    - name: Install apktool
      run: |
        wget https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool
        wget https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar
        chmod +x apktool
        sudo mv apktool /usr/local/bin/apktool
        sudo mv apktool_2.9.3.jar /usr/local/bin/apktool.jar

    # 5️⃣ Download Minecraft APK
    - name: Download APK
      run: |
        mkdir -p ks-craft
        wget https://files.apkdlink.com/minecraft/minecraft-minecraft-apk-latest-october.apk \
        -O ks-craft/minecraft.apk

    # 6️⃣ Decompile APK (ALL FILES)
    - name: Decompile APK resources
      run: |
        apktool d ks-craft/minecraft.apk \
        -o ks-craft/decompiled -f

    # 7️⃣ Debug (proof files exist)
    - name: List ks-craft contents
      run: |
        ls -R ks-craft

    # 8️⃣ Upload EVERYTHING inside ks-craft
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ks-craft-all-files
        path: ks-craft/
